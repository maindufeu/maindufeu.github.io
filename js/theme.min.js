const graph=ForceGraph(),CONTAINER_ID=(document.addEventListener("DOMContentLoaded",function(){null!=document.getElementById(CONTAINER_ID)&&fetch("/graph-data.json").then(e=>e.json()).then(e=>{var n,e=augmentGraphInfo(e),e=(Actions.refresh(e),initDataviz(),window.location.href),t="/note/",i=e.indexOf(t);-1!=i&&""!=n?(-1!=(i=(n=e.substr(i+t.length)).indexOf("/"))&&(n=n.substr(0,i)),Actions.highlightNode(n),graph.width(800),graph.height(600),graph.onEngineStop(()=>{var e,t,i=graph.graphData().nodes;for([e,t]of Object.entries(i))if(t.id==n){graph.centerAt(t.x,t.y,500),graph.zoom(4,500);break}})):(graph.d3Force("center",null),graph.zoom(4,1e3))})},!1),"graph"),styleFallback={background:"#00000000",fontSize:16,lineColor:"#D08770",lineWidth:.2,particleWidth:1,highlightedForeground:"#2d96bd",node:{note:"#D08770",placeholder:"#545454"}},sizeScale=d3.scaleLinear().domain([0,30]).range([.5,2]).clamp(!0),labelAlpha=d3.scaleLinear().domain([1.2,2]).range([0,1]).clamp(!0),defaultStyle={background:styleFallback.background,fontSize:parseInt(styleFallback.fontSize)-2,lineColor:styleFallback.lineColor,lineWidth:parseFloat(styleFallback.lineWidth),particleWidth:parseFloat(styleFallback.particleWidth),highlightedForeground:styleFallback.highlightedForeground,node:{note:styleFallback.node.note,placeholder:styleFallback.node.placeholder}};let model={selectedNodes:new Set,hoverNode:null,focusNodes:new Set,focusLinks:new Set,nodeInfo:{},data:{nodes:[],links:[]},style:defaultStyle};function update(e){e(model);const t=new Set,i=new Set;model.hoverNode&&(t.add(model.hoverNode),null!=(e=model.nodeInfo[model.hoverNode]))&&(e.neighbors.forEach(e=>t.add(e)),e.links.forEach(e=>i.add(e))),model.selectedNodes&&model.selectedNodes.forEach(e=>{t.add(e);e=model.nodeInfo[e];null!=e&&(e.neighbors.forEach(e=>t.add(e)),e.links.forEach(e=>i.add(e)))}),model.focusNodes=t,model.focusLinks=i}const Actions={refresh:o=>update(t=>{t.nodeInfo=o.nodes;var e=o.links;const i=new Set(Object.keys(t.nodeInfo)),n=new Set;t.data.nodes.forEach((e,t)=>{i.has(e.id)?i.delete(e.id):n.add(t)}),n.forEach(e=>{t.data.nodes.splice(e,1)}),i.forEach(e=>{t.data.nodes.push({id:e})}),t.data.links=e,t.hoverNode=null!=t.nodeInfo[t.hoverNode]?t.hoverNode:null,t.selectedNodes=new Set(Array.from(t.selectedNodes).filter(e=>null!=t.nodeInfo[e])),graph.graphData(t.data)}),selectNode:(t,i)=>update(e=>{i||e.selectedNodes.clear(),null!=t&&e.selectedNodes.add(t)}),highlightNode:t=>update(e=>{e.hoverNode=t}),updateStyle:e=>{e&&(model.style={...defaultStyle,...e,lineColor:e.lineColor||e.node&&e.node.note||defaultStyle.lineColor,node:{...defaultStyle.node,...e.node}},graph.backgroundColor(model.style.background))}};function initDataviz(){var e=document.getElementById(CONTAINER_ID);graph(e).cooldownTicks(100).graphData(model.data).backgroundColor(model.style.background).linkHoverPrecision(8).d3Force("x",d3.forceX()).d3Force("y",d3.forceY()).d3Force("collide",d3.forceCollide(graph.nodeRelSize())).linkWidth(()=>model.style.lineWidth||styleFallback.lineWidth).linkDirectionalParticles(1).linkDirectionalParticleWidth(e=>"highlighted"===getLinkState(e,model)?model.style.particleWidth||styleFallback.particleWidth:0).nodeCanvasObject((e,t,i)=>{var n,o,a,l,s,r=model.nodeInfo[e.id];null==r?console.error(`Could not find info for node ${e.id} - skipping`):(n=sizeScale(r.neighbors.length),{fill:o,border:a}=getNodeColor(e.id,model),l=model.style.fontSize/i,s=getNodeState(e.id,model),s=o.copy({opacity:"regular"===s?labelAlpha(i):"highlighted"===s?1:Math.min(labelAlpha(i),o.opacity)}),i=r.title,Draw(t).circle(e.x,e.y,n+.2,a).circle(e.x,e.y,n,o).text(i,e.x,e.y+n+1,l,s.toString()))}).linkColor(e=>getLinkColor(e,model)).onNodeHover(e=>{Actions.highlightNode(e?.id)}).onNodeClick(e=>{window.location.href="/note/"+e.id}).onNodeDragEnd(e=>{e.fx=e.x,e.fy=e.y})}function augmentGraphInfo(n){return Object.values(n.nodes).forEach(e=>{e.neighbors=[],e.links=[]}),n.links.forEach(e=>{var t=n.nodes[e.source],i=n.nodes[e.target];t.neighbors.push(i.id),i.neighbors.push(t.id),t.links.push(e),i.links.push(e)}),n}function getNodeColor(e,t){var i=t.nodeInfo[e],n=t.style,o=d3.rgb(n.node[i.type??"note"]??n.node.note);switch(getNodeState(e,t)){case"regular":return{fill:o,border:o};case"lessened":var a=d3.rgb(o).copy({opacity:.05});return{fill:a,border:a};case"highlighted":return{fill:o,border:d3.rgb(n.highlightedForeground)};default:throw new Error("Unknown type for node",e)}}function getLinkColor(e,t){var i=t.style;switch(getLinkState(e,t)){case"regular":return i.lineColor;case"highlighted":return i.highlightedForeground;case"lessened":return d3.hsl(i.lineColor).copy({opacity:.5});default:throw new Error("Unknown type for link",e)}}function getNodeState(e,t){return t.selectedNodes.has(e)||t.hoverNode===e?"highlighted":0===t.focusNodes.size||t.focusNodes.has(e)?"regular":"lessened"}function getLinkState(e,t){return 0===t.focusNodes.size?"regular":t.focusLinks.has(e)?"highlighted":"lessened"}const Draw=a=>({circle:function(e,t,i,n){return a.beginPath(),a.arc(e,t,i,0,2*Math.PI,!1),a.fillStyle=n,a.fill(),a.closePath(),this},text:function(e,t,i,n,o){return a.font=n+"px Sans-Serif",a.textAlign="center",a.textBaseline="top",a.fillStyle=o,a.fillText(e,t,i),this}}),ACTIVE_LINK_CLASS="tc-link--active",CONFIG={highlight:"enable",tiddler_width:"600"},queryString=window.location.search,urlParams=new URLSearchParams(queryString);let noteIdParams=urlParams.getAll("n"),pages=(noteIdParams=[...new Set(noteIdParams)],[]),elem=(window.onload=function(){startup(),initializePreviews(document.querySelector(".single"));var e=noteIdParams.indexOf(location.pathname.replace("/note/","").replace("/",""));-1<e&&noteIdParams.splice(e,1);for(let e=0;e<noteIdParams.length;e++)fetchNote("/note/"+noteIdParams[e],e+1)},document.getElementsByClassName("single")[0]);if(null!=elem){let e=elem.getAttribute("data-uuid");pages=[e]}let switchDirectionWindowWidth=900;function fetchNote(a,l){var e;if(-1!=pages.indexOf(a))scroll(document.querySelector('.single[data-uuid="'+a+'"]'));else{let o=document.querySelector("section.tc-story-river");null==o?window.location.href=a:(l=Number(l)||pages.length,e=new Request(a),fetch(e).then(function(e){e.ok?e.text().then(function(e){var t=Array.prototype.slice.call(o.children),i=document.createElement("template");for(let e=l;e<pages.length;e++)o.removeChild(t[e]),destroyPreviews(t[e]);pages=pages.slice(0,l);var n=document.createElement("html"),e=(n.innerHTML=e,n.querySelector("div.single")),n=(null!=e&&(i.innerHTML=e.outerHTML),i.content.querySelector(".single"));pages.push(a),o.appendChild(n),setTimeout(function(e,t){e.dataset.level=t+1,initializePreviews(e,t+1),e.scrollIntoView()}.bind(null,n,l),10),updateLinkStatuses(),(new Theme).initTable()}):window.location.href="/404.html"}))}}function updateLinkStatuses(){Array.prototype.slice.call(document.querySelectorAll("a[data-uuid]")).forEach(function(e){-1!==pages.indexOf(e.dataset.uuid)?(e.classList.add("linked"),e._tippy&&e._tippy.disable()):(e.classList.remove("linked"),e._tippy&&e._tippy.enable())})}function destroyPreviews(e){(links=Array.prototype.slice.call(e.querySelectorAll("a[data-uuid]"))).forEach(function(e){e.hasOwnProperty("_tippy")&&e._tippy.destroy()})}let tippyOptions={allowHTML:!0,theme:"light",interactive:!0,interactiveBorder:10,delay:100,touch:"none",maxWidth:"none",inlinePositioning:!1,placement:"bottom"};function createPreview(e,t){uuid=e.dataset.uuid,level=Number(e.dataset.level),tip=tippy(e,Object.assign({},tippyOptions,{content:'<iframe width="400px" height="300px" src="'+uuid+'embed.html"></iframe>'},t))}function initializePreviews(e,t){t=t||pages.length,null!=e&&(links=Array.prototype.slice.call(e.querySelectorAll("a[data-uuid]"))).forEach(function(e){e.dataset.level=t,e.classList.contains("garden-note-link")&&createPreview(e,{placement:window.innerWidth>switchDirectionWindowWidth?"bottom":"top"}),e.addEventListener("click",function(e){e.ctrlKey||e.metaKey||""==this.dataset.uuid&&null==this.dataset.uuid||(e.preventDefault(),urlParams.delete("n"),pages.slice(0,this.dataset.level).filter(e=>e!=this.dataset.uuid).filter(e=>e).forEach(e=>{urlParams.append("n",e.replace("/note/","").replace("/",""))}),urlParams.append("n",this.dataset.uuid.replace("/note/","").replace("/","")),history.replaceState("","",location.protocol+"//"+location.host+location.pathname+"?"+urlParams.toString()),fetchNote(this.dataset.uuid,this.dataset.level))})})}let lastWidth=window.innerWidth;function startup(){var e=throttle(tiddlerFrameEffects,10);window.addEventListener("scroll",e,!0),window.addEventListener("change",reinitiateTiddlerFrameEffects)}function tiddlersCount(e){e=e.target.childElementCount;document.body.style.setProperty("--tiddler-count",e)}function scroll(e){var t,i,n;null!=e&&(tiddlerElement=e,window.matchMedia("(min-width: 960px)").matches?(e=tiddlerElement.parentElement,n=Array.from(e.querySelectorAll("div[data-tiddler-title]")).indexOf(tiddlerElement),t=CONFIG.tiddler_width,i=window.innerWidth,n=Math.max(n*t-(i/2-t/2),0),e.scroll({left:n,behavior:"smooth"})):tiddlerElement.scrollIntoView({behavior:"smooth"}))}function tiddlerFrameEffects(){let h=Array.from(document.querySelectorAll(".tc-tiddler-frame")),m=h.length;if(0!==m){let r=Number(window.getComputedStyle(h[0]).paddingRight.slice(0,-2)),c=h[0].offsetWidth,d=window.innerWidth;h.forEach(function(e,t){var i,n,o,a,l,s;0!==t&&(i=e.querySelector(".tc-tiddler__title"))&&(o=(n=h[t-1]).querySelector(".tc-tiddler__title"),a=(s=e.getBoundingClientRect().left)<100+t*r,l=s>d-(100+(m-t)*r),s=s<c+(t-1)*r,e.classList.toggle("tc-tiddler__frame--overlay",s),o&&(o.classList.toggle("tc-tiddler__title--start-active",a),l||n.classList.toggle("tc-tiddler__frame--hide",a)),a&&i.classList.remove("tc-tiddler__title--end"),l?(e.classList.add("tc-tiddler__frame--overlay"),e.classList.add("tc-tiddler__frame--hide"),i.classList.add("tc-tiddler__title--end","tc-tiddler__title--end-active")):(s||e.classList.remove("tc-tiddler__frame--overlay"),e.classList.remove("tc-tiddler__frame--hide"),i.classList.remove("tc-tiddler__title--end-active")))})}}function reinitiateTiddlerFrameEffects(e){var t=$tw.utils.getAnimationDuration()||0;setTimeout(tiddlerFrameEffects,t)}function hop(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function throttle(e,t){let i=!1;return function(){i||(e.call(),i=!0,setTimeout(function(){i=!1},t))}}window.addEventListener("resize",function(e){window.innerWidth>switchDirectionWindowWidth!=lastWidth>switchDirectionWindowWidth&&[].slice.call(document.querySelectorAll(".single[data-uuid]")).forEach(function(e){destroyPreviews(e),initializePreviews(e,Number(e.dataset.level))}),lastWidth=window.innerWidth});class Util{forEach(t,i){t=t||[];for(let e=0;e<t.length;e++)i(t[e])}getScrollTop(){return document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}isMobile(){return window.matchMedia("only screen and (max-width: 680px)").matches}isTocStatic(){return window.matchMedia("only screen and (max-width: 960px)").matches}animateCSS(e,t,i,n){Array.isArray(t)||(t=[t]),e.classList.add("animated",...t);const o=()=>{e.classList.remove("animated",...t),e.removeEventListener("animationend",o),"function"==typeof n&&n()};i||e.addEventListener("animationend",o,!1)}}class Theme{constructor(){this.config=window.config,this.data=this.config.data,this.isDark="dark"===document.body.getAttribute("theme"),this.util=new Util,this.newScrollTop=this.util.getScrollTop(),this.oldScrollTop=this.newScrollTop,this.scrollEventSet=new Set,this.resizeEventSet=new Set,this.switchThemeEventSet=new Set,this.clickMaskEventSet=new Set,window.objectFitImages&&objectFitImages()}initSVGIcon(){this.util.forEach(document.querySelectorAll("[data-svg-src]"),i=>{fetch(i.getAttribute("data-svg-src")).then(e=>e.text()).then(e=>{var t=document.createElement("div"),e=(t.insertAdjacentHTML("afterbegin",e),t.firstChild),t=(e.setAttribute("data-svg-src",i.getAttribute("data-svg-src")),e.classList.add("icon"),e.getElementsByTagName("title"));t.length&&e.removeChild(t[0]),i.parentElement.replaceChild(e,i)}).catch(e=>{console.error(e)})})}initTwemoji(){this.config.twemoji&&twemoji.parse(document.body)}initMenuMobile(){const e=document.getElementById("menu-toggle-mobile"),t=document.getElementById("menu-mobile");e.addEventListener("click",()=>{document.body.classList.toggle("blur"),e.classList.toggle("active"),t.classList.toggle("active")},!1),this._menuMobileOnClickMask=this._menuMobileOnClickMask||(()=>{e.classList.remove("active"),t.classList.remove("active")}),this.clickMaskEventSet.add(this._menuMobileOnClickMask)}initSwitchTheme(){this.util.forEach(document.getElementsByClassName("theme-switch"),e=>{e.addEventListener("click",()=>{"dark"===document.body.getAttribute("theme")?document.body.setAttribute("theme","light"):document.body.setAttribute("theme","dark"),this.isDark=!this.isDark,window.localStorage&&localStorage.setItem("theme",this.isDark?"dark":"light");for(var e of this.switchThemeEventSet)e()},!1)})}initSearch(){const o=this.config.search,t=this.util.isMobile();if(!(!o||t&&this._searchMobileOnce||!t&&this._searchDesktopOnce)){const a=o.maxResultLength||10,s=o.snippetLength||50,r=o.highlightTag||"em",i=t?"mobile":"desktop",n=document.getElementById("header-"+i),l=document.getElementById("search-input-"+i);var e=document.getElementById("search-toggle-"+i);const c=document.getElementById("search-loading-"+i),d=document.getElementById("search-clear-"+i),h=(t?(this._searchMobileOnce=!0,l.addEventListener("focus",()=>{document.body.classList.add("blur"),n.classList.add("open")},!1),document.getElementById("search-cancel-mobile").addEventListener("click",()=>{n.classList.remove("open"),document.body.classList.remove("blur"),document.getElementById("menu-toggle-mobile").classList.remove("active"),document.getElementById("menu-mobile").classList.remove("active"),c.style.display="none",d.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")},!1),d.addEventListener("click",()=>{d.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")},!1),this._searchMobileOnClickMask=this._searchMobileOnClickMask||(()=>{n.classList.remove("open"),c.style.display="none",d.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")}),this.clickMaskEventSet.add(this._searchMobileOnClickMask)):(this._searchDesktopOnce=!0,e.addEventListener("click",()=>{document.body.classList.add("blur"),n.classList.add("open"),l.focus()},!1),d.addEventListener("click",()=>{d.style.display="none",this._searchDesktop&&this._searchDesktop.autocomplete.setVal("")},!1),this._searchDesktopOnClickMask=this._searchDesktopOnClickMask||(()=>{n.classList.remove("open"),c.style.display="none",d.style.display="none",this._searchDesktop&&this._searchDesktop.autocomplete.setVal("")}),this.clickMaskEventSet.add(this._searchDesktopOnClickMask)),l.addEventListener("input",()=>{""===l.value?d.style.display="none":d.style.display="inline"},!1),()=>{var e=autocomplete("#search-input-"+i,{hint:!1,autoselect:!0,dropdownMenuContainer:"#search-dropdown-"+i,clearOnSelected:!0,cssClasses:{noPrefix:!0},debug:!0},{name:"search",source:(e,t)=>{c.style.display="inline",d.style.display="none";const i=e=>{c.style.display="none",d.style.display="inline",t(e)};if("lunr"===o.type){const n=()=>{lunr.queryHandler&&(e=lunr.queryHandler(e));const l={};return this._index.search(e).forEach(({ref:e,matchData:{metadata:i}})=>{e=this._indexData[e];let{uri:n,title:o,content:a}=e;if(!l[n]){let t=0;Object.values(i).forEach(({content:e})=>{e&&((e=e.position[0][0])<t||0===t)&&(t=e)}),t-=s/5,a=0<t?(t+=a.substr(t,20).lastIndexOf(" ")+1,"..."+a.substr(t,s)):a.substr(0,s),Object.keys(i).forEach(e=>{o=o.replace(new RegExp(`(${e})`,"gi"),`<${r}>$1</${r}>`),a=a.replace(new RegExp(`(${e})`,"gi"),`<${r}>$1</${r}>`)}),l[n]={uri:n,title:o,date:e.date,context:a}}}),Object.values(l).slice(0,a)};this._index?i(n()):fetch(o.lunrIndexURL).then(e=>e.json()).then(e=>{const t={};this._index=lunr(function(){o.lunrLanguageCode&&this.use(lunr[o.lunrLanguageCode]),this.ref("objectID"),this.field("title",{boost:50}),this.field("tags",{boost:20}),this.field("categories",{boost:20}),this.field("content",{boost:10}),this.metadataWhitelist=["position"],e.forEach(e=>{t[e.objectID]=e,this.add(e)})}),this._indexData=t,i(n())}).catch(e=>{console.error(e),i([])})}else"algolia"===o.type&&(this._algoliaIndex=this._algoliaIndex||algoliasearch(o.algoliaAppID,o.algoliaSearchKey).initIndex(o.algoliaIndex),this._algoliaIndex.search(e,{offset:0,length:8*a,attributesToHighlight:["title"],attributesToSnippet:["content:"+s],highlightPreTag:`<${r}>`,highlightPostTag:`</${r}>`}).then(({hits:e})=>{const o={};e.forEach(({uri:e,date:t,_highlightResult:{title:i},_snippetResult:{content:n}})=>{o[e]&&o[e].context.length>n.value||(o[e]={uri:e,title:i.value,date:t,context:n.value})}),i(Object.values(o).slice(0,a))}).catch(e=>{console.error(e),i([])}))},templates:{suggestion:({title:e,date:t,context:i})=>`<div><span class="suggestion-title">${e}</span><span class="suggestion-date">${t}</span></div><div class="suggestion-context">${i}</div>`,empty:({query:e})=>`<div class="search-empty">${o.noResultsFound}: <span class="search-query">"${e}"</span></div>`,footer:({})=>{var{searchType:e,icon:t,href:i}="algolia"===o.type?{searchType:"algolia",icon:'<i class="fab fa-algolia fa-fw"></i>',href:"https://www.algolia.com/"}:{searchType:"Lunr.js",icon:"",href:"https://lunrjs.com/"};return`<div class="search-footer">Search by <a href="${i}" rel="noopener noreffer" target="_blank">${t} ${e}</a></div>`}}});e.on("autocomplete:selected",(e,t,i,n)=>{window.location.assign(t.uri)}),t?this._searchMobile=e:this._searchDesktop=e});if(o.lunrSegmentitURL&&!document.getElementById("lunr-segmentit")){const m=document.createElement("script");m.id="lunr-segmentit",m.type="text/javascript",m.src=o.lunrSegmentitURL,m.async=!0,m.readyState?m.onreadystatechange=()=>{"loaded"!=m.readyState&&"complete"!=m.readyState||(m.onreadystatechange=null,h())}:m.onload=()=>{h()},document.body.appendChild(m)}else h()}}initDetails(){this.util.forEach(document.getElementsByClassName("details"),e=>{e.getElementsByClassName("details-summary")[0].addEventListener("click",()=>{e.classList.toggle("open")},!1)})}initLightGallery(){this.config.lightGallery&&lightGallery(document.getElementById("content"),this.config.lightGallery)}initHighlight(){this.util.forEach(document.querySelectorAll(".highlight > pre.chroma"),e=>{var t=document.createElement("div"),i=(t.className=e.className,document.createElement("table")),n=(t.appendChild(i),document.createElement("tbody")),i=(i.appendChild(n),document.createElement("tr")),n=(n.appendChild(i),document.createElement("td"));i.appendChild(n),e.parentElement.replaceChild(t,e),n.appendChild(e)}),this.util.forEach(document.querySelectorAll(".highlight > .chroma"),e=>{var t=e.querySelectorAll("pre.chroma > code");if(t.length){const o=t[t.length-1];var t=document.createElement("div"),i=(t.className="code-header "+o.className.toLowerCase(),document.createElement("span")),i=(i.classList.add("code-title"),i.insertAdjacentHTML("afterbegin",'<i class="arrow fas fa-chevron-right fa-fw"></i>'),i.addEventListener("click",()=>{e.classList.toggle("open")},!1),t.appendChild(i),document.createElement("span")),i=(i.insertAdjacentHTML("afterbegin",'<i class="fas fa-ellipsis-h fa-fw"></i>'),i.classList.add("ellipses"),i.addEventListener("click",()=>{e.classList.add("open")},!1),t.appendChild(i),document.createElement("span")),n=(i.insertAdjacentHTML("afterbegin",'<i class="far fa-copy fa-fw"></i>'),i.classList.add("copy"),o.innerText);(this.config.code.maxShownLines<0||n.split("\n").length<this.config.code.maxShownLines+2)&&e.classList.add("open"),this.config.code.copyTitle&&(i.setAttribute("data-clipboard-text",n),i.title=this.config.code.copyTitle,new ClipboardJS(i).on("success",e=>{this.util.animateCSS(o,"flash")}),t.appendChild(i)),e.insertBefore(t,e.firstChild)}})}initTable(){this.util.forEach(document.querySelectorAll(".content table"),e=>{var t=e.closest(".table-wrapper");Boolean(t)||((t=document.createElement("div")).className="table-wrapper",e.parentElement.replaceChild(t,e),t.appendChild(e))})}initHeaderLink(){for(let e=1;e<=6;e++)this.util.forEach(document.querySelectorAll(".single .content > h"+e),e=>{e.classList.add("headerLink"),e.insertAdjacentHTML("afterbegin",`<a href="#${e.id}" class="header-mark"></a>`)})}initToc(){const l=document.getElementById("TableOfContents");if(null!==l)if(document.getElementById("toc-static").getAttribute("kept")||this.util.isTocStatic()){var e=document.getElementById("toc-content-static");l.parentElement!==e&&(l.parentElement.removeChild(l),e.appendChild(l)),this._tocOnScroll&&this.scrollEventSet.delete(this._tocOnScroll)}else{e=document.getElementById("toc-content-auto");l.parentElement!==e&&(l.parentElement.removeChild(l),e.appendChild(l));const s=document.getElementById("toc-auto");var e=document.getElementsByClassName("page")[0],t=e.getBoundingClientRect();s.style.left=t.left+t.width+20+"px",s.style.maxWidth=e.getBoundingClientRect().left-20+"px",s.style.visibility="visible";const r=l.querySelectorAll("a:first-child"),c=l.getElementsByTagName("li"),d=document.getElementsByClassName("headerLink"),h="normal"!==document.body.getAttribute("header-desktop"),m=document.getElementById("header-desktop").offsetHeight,u=20+(h?m:0),g=s.offsetTop,p=g-u+(h?0:m);this._tocOnScroll=this._tocOnScroll||(()=>{var e=document.getElementById("post-footer").offsetTop-s.getBoundingClientRect().height,t=e-u+(h?0:m),i=(this.newScrollTop<p?(s.style.position="absolute",s.style.top=g+"px"):this.newScrollTop>t?(s.style.position="absolute",s.style.top=e+"px"):(s.style.position="fixed",s.style.top=u+"px"),this.util.forEach(r,e=>{e.classList.remove("active")}),this.util.forEach(c,e=>{e.classList.remove("has-active")}),20+(h?m:0));let n=d.length-1;for(let e=0;e<d.length-1;e++){var o=d[e].getBoundingClientRect().top,a=d[e+1].getBoundingClientRect().top;if(0==e&&i<o||o<=i&&i<a){n=e;break}}if(-1!==n){r[n].classList.add("active");let e=r[n].parentElement;for(;e!==l;)e.classList.add("has-active"),e=e.parentElement.parentElement}}),this._tocOnScroll(),this.scrollEventSet.add(this._tocOnScroll)}}initMath(){this.config.math&&renderMathInElement(document.body,this.config.math)}initMermaid(){var e=document.getElementsByClassName("mermaid");e.length&&(mermaid.initialize({startOnLoad:!1,theme:"null"}),this.util.forEach(e,t=>{mermaid.mermaidAPI.render("svg-"+t.id,this.data[t.id],e=>{t.insertAdjacentHTML("afterbegin",e)},t)}))}initEcharts(){this._echartsOnSwitchTheme=this._echartsOnSwitchTheme||(()=>{this._echartsArr=this._echartsArr||[];for(let e=0;e<this._echartsArr.length;e++)this._echartsArr[e].dispose();this._echartsArr=[],this.util.forEach(document.getElementsByClassName("echarts"),e=>{var t=echarts.init(e,this.isDark?"dark":"macarons",{renderer:"svg"});t.setOption(JSON.parse(this.data[e.id])),this._echartsArr.push(t)})}),this.switchThemeEventSet.add(this._echartsOnSwitchTheme),this._echartsOnSwitchTheme(),this._echartsOnResize=this._echartsOnResize||(()=>{for(let e=0;e<this._echartsArr.length;e++)this._echartsArr[e].resize()}),this.resizeEventSet.add(this._echartsOnResize)}initMapbox(){this.config.mapbox&&(mapboxgl.accessToken=this.config.mapbox.accessToken,mapboxgl.setRTLTextPlugin(this.config.mapbox.RTLTextPlugin),this._mapboxArr=this._mapboxArr||[],this.util.forEach(document.getElementsByClassName("mapbox"),e=>{var{lng:t,lat:i,zoom:n,lightStyle:o,darkStyle:a,marked:l,navigation:s,geolocate:r,scale:c,fullscreen:d}=this.data[e.id],e=new mapboxgl.Map({container:e,center:[t,i],zoom:n,minZoom:.2,style:this.isDark?a:o,attributionControl:!1});l&&(new mapboxgl.Marker).setLngLat([t,i]).addTo(e),s&&e.addControl(new mapboxgl.NavigationControl,"bottom-right"),r&&e.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},showUserLocation:!0,trackUserLocation:!0}),"bottom-right"),c&&e.addControl(new mapboxgl.ScaleControl),d&&e.addControl(new mapboxgl.FullscreenControl),e.addControl(new MapboxLanguage),this._mapboxArr.push(e)}),this._mapboxOnSwitchTheme=this._mapboxOnSwitchTheme||(()=>{this.util.forEach(this._mapboxArr,e=>{var t=e.getContainer(),{lightStyle:t,darkStyle:i}=this.data[t.id];e.setStyle(this.isDark?i:t),e.addControl(new MapboxLanguage)})}),this.switchThemeEventSet.add(this._mapboxOnSwitchTheme))}initTypeit(){if(this.config.typeit){const a=this.config.typeit,l=a.speed||100,s=a.cursorSpeed||1e3,r=a.cursorChar||"|";Object.values(a.data).forEach(n=>{const o=e=>{var t=n[e];const i=new TypeIt("#"+t,{strings:this.data[t],speed:l,lifeLike:!0,cursorSpeed:s,cursorChar:r,waitUntilVisible:!0,afterComplete:()=>{e===n.length-1?0<=a.duration&&window.setTimeout(()=>{i.destroy()},a.duration):(i.destroy(),o(e+1))}}).go()};o(0)})}}initComment(){if(this.config.comment&&(this.config.comment.gitalk&&(this.config.comment.gitalk.body=decodeURI(window.location.href),new Gitalk(this.config.comment.gitalk).render("gitalk")),this.config.comment.valine&&new Valine(this.config.comment.valine),this.config.comment.utterances)){const t=this.config.comment.utterances;var e=document.createElement("script");e.src="https://utteranc.es/client.js",e.type="text/javascript",e.setAttribute("repo",t.repo),e.setAttribute("issue-term",t.issueTerm),t.label&&e.setAttribute("label",t.label),e.setAttribute("theme",this.isDark?t.darkTheme:t.lightTheme),e.crossOrigin="anonymous",e.async=!0,document.getElementById("utterances").appendChild(e),this._utterancesOnSwitchTheme=this._utterancesOnSwitchTheme||(()=>{var e={type:"set-theme",theme:this.isDark?t.darkTheme:t.lightTheme};document.querySelector(".utterances-frame").contentWindow.postMessage(e,"https://utteranc.es")}),this.switchThemeEventSet.add(this._utterancesOnSwitchTheme)}}initSmoothScroll(){SmoothScroll&&new SmoothScroll('[href^="#"]',{speed:300,speedAsDuration:!0,header:"#header-desktop"})}initCookieconsent(){this.config.cookieconsent&&cookieconsent.initialise(this.config.cookieconsent)}onScroll(){const n=[];var e;"auto"===document.body.getAttribute("header-desktop")&&n.push(document.getElementById("header-desktop")),"auto"===document.body.getAttribute("header-mobile")&&n.push(document.getElementById("header-mobile")),document.getElementById("comments")&&((e=document.getElementById("view-comments")).href="#comments",e.style.display="block");const o=document.getElementById("fixed-buttons");window.addEventListener("scroll",()=>{this.newScrollTop=this.util.getScrollTop();const t=this.newScrollTop-this.oldScrollTop;var e,i=this.util.isMobile();this.util.forEach(n,e=>{20<t?(e.classList.remove("fadeInDown"),this.util.animateCSS(e,["fadeOutUp","faster"],!0)):t<-20&&(e.classList.remove("fadeOutUp"),this.util.animateCSS(e,["fadeInDown","faster"],!0))}),100<this.newScrollTop?i&&20<t?(o.classList.remove("fadeIn"),this.util.animateCSS(o,["fadeOut","faster"],!0)):(!i||t<-20)&&(o.style.display="block",o.classList.remove("fadeOut"),this.util.animateCSS(o,["fadeIn","faster"],!0)):(i||(o.classList.remove("fadeIn"),this.util.animateCSS(o,["fadeOut","faster"],!0)),o.style.display="none");for(e of this.scrollEventSet)e();this.oldScrollTop=this.newScrollTop},!1)}onResize(){window.addEventListener("resize",()=>{this._resizeTimeout||(this._resizeTimeout=window.setTimeout(()=>{this._resizeTimeout=null;for(var e of this.resizeEventSet)e();this.initToc(),this.initMermaid(),this.initSearch()},100))},!1)}onClickMask(){document.getElementById("mask").addEventListener("click",()=>{for(var e of this.clickMaskEventSet)e();document.body.classList.remove("blur")},!1)}init(){try{this.initSVGIcon(),this.initTwemoji(),this.initMenuMobile(),this.initSwitchTheme(),this.initSearch(),this.initDetails(),this.initLightGallery(),this.initHighlight(),this.initTable(),this.initHeaderLink(),this.initSmoothScroll(),this.initMath(),this.initMermaid(),this.initEcharts(),this.initTypeit(),this.initMapbox(),this.initCookieconsent()}catch(e){console.error(e)}window.setTimeout(()=>{this.initToc(),this.initComment(),this.onScroll(),this.onResize(),this.onClickMask()},100)}}const themeInit=()=>{(new Theme).init()};"loading"!==document.readyState?themeInit():document.addEventListener("DOMContentLoaded",themeInit,!1);